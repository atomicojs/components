"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=require("react");function t(n){return Array.prototype.slice.call(n)}function e(){return Date.now()}function i(n,t,e){if(t="data-keen-slider-"+t,null===e)return n.removeAttribute(t);n.setAttribute(t,e||"")}function r(n,e){return e=e||document,"function"==typeof n&&(n=n(e)),Array.isArray(n)?n:"string"==typeof n?t(e.querySelectorAll(n)):n instanceof HTMLElement?[n]:n instanceof NodeList?t(n):[]}function a(n){n.raw&&(n=n.raw),n.cancelable&&!n.defaultPrevented&&n.preventDefault()}function o(n){n.raw&&(n=n.raw),n.stopPropagation&&n.stopPropagation()}function u(){var n=[];return{add:function(t,e,i,r){t.addListener?t.addListener(i):t.addEventListener(e,i,r),n.push([t,e,i,r])},input:function(n,t,e,i){this.add(n,t,function(n){return function(t){t.nativeEvent&&(t=t.nativeEvent);var e=t.changedTouches||[],i=t.targetTouches||[],r=t.detail&&t.detail.x?t.detail:null;return n({id:r?r.identifier?r.identifier:"i":i[0]?i[0]?i[0].identifier:"e":"d",idChanged:r?r.identifier?r.identifier:"i":e[0]?e[0]?e[0].identifier:"e":"d",raw:t,x:r&&r.x?r.x:i[0]?i[0].screenX:r?r.x:t.pageX,y:r&&r.y?r.y:i[0]?i[0].screenY:r?r.y:t.pageY})}}(e),i)},purge:function(){n.forEach((function(n){n[0].removeListener?n[0].removeListener(n[2]):n[0].removeEventListener(n[1],n[2],n[3])})),n=[]}}}function c(n,t,e){return Math.min(Math.max(n,t),e)}function s(n){return(n>0?1:0)-(n<0?1:0)||+n}function d(n){return n.getBoundingClientRect()}function l(n,t,e,i){var r=n&&n[t];return null==r?e:i&&"function"==typeof r?r():r}function f(n){return Math.round(1e6*n)/1e6}function p(n,t){if(n===t)return!0;var e=typeof n;if(e!==typeof t)return!1;if("object"!==e||null===n||null===t)return"function"===e&&n.toString()===t.toString();if(n.length!==t.length||Object.getOwnPropertyNames(n).length!==Object.getOwnPropertyNames(t).length)return!1;for(var i in n)if(!p(n[i],t[i]))return!1;return!0}function v(n,t){return p(n.current,t)||(n.current=t),n.current}var m=function(){return m=Object.assign||function(n){for(var t,e=1,i=arguments.length;e<i;e++)for(var r in t=arguments[e])Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n},m.apply(this,arguments)};function h(n,t,e){if(e||2===arguments.length)for(var i,r=0,a=t.length;r<a;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return n.concat(i||Array.prototype.slice.call(t))}function g(n){var t,e,i,r,a,o;function u(t){o||(o=t),c(!0);var a=t-o;a>i&&(a=i);var l=r[e];if(l[3]<a)return e++,u(t);var f=l[2],p=l[4],v=l[0],m=l[1]*(0,l[5])(0===p?1:(a-f)/p);if(m&&n.track.to(v+m),a<i)return d();o=null,c(!1),s(null),n.emit("animationEnded")}function c(n){t.active=n}function s(n){t.targetIdx=n}function d(){var n;n=u,a=window.requestAnimationFrame(n)}function l(){var t;t=a,window.cancelAnimationFrame(t),c(!1),s(null),o&&n.emit("animationStopped"),o=null}return t={active:!1,start:function(t){if(l(),n.track.details){var a=0,o=n.track.details.position;e=0,i=0,r=t.map((function(n){var t,e=o,r=null!==(t=n.earlyExit)&&void 0!==t?t:n.duration,u=n.easing,c=n.distance*u(r/n.duration)||0;o+=c;var s=i;return i+=r,a+=c,[e,n.distance,s,i,n.duration,u]})),s(n.track.distToIdx(a)),d(),n.emit("animationStarted")}},stop:l,targetIdx:null}}function b(n){var t,i,r,a,o,u,d,p,v,m,g,b,y,x,k=1/0,w=[],M=null,T=0;function C(n){P(T+n)}function E(n){var t=z(T+n).abs;return O(t)?t:null}function z(n){var t=Math.floor(Math.abs(n/i)),e=f((n%i+i)%i),r=s(n),a=d.indexOf(h([],d,!0).reduce((function(n,t){return Math.abs(t-e)<Math.abs(n-e)?t:n}))),o=a;return r<0&&0!==e&&t++,a===u&&(o=0,t+=r>0?1:-1),{abs:o+t*u*r,origin:a,rel:o}}function I(n,t,e){var i;if(t||!S())return A(n,e);if(!O(n))return null;var r=z(null!=e?e:T),a=r.abs,o=n-r.rel,c=a+o;i=A(c);var d=A(c-u*s(o));return(null!==d&&Math.abs(d)<Math.abs(i)||null===i)&&(i=d),f(i)}function A(n,t){if(null==t&&(t=f(T)),!O(n)||null===n)return null;n=Math.round(n);var e=z(t),r=e.abs,a=e.rel,o=e.origin,c=L(n),s=(t%i+i)%i,l=d[o],p=Math.floor((n-(r-a))/u)*i;return f(l-s-l+d[c]+p+(o===u?i:0))}function O(n){return D(n)===n}function D(n){return c(n,v,m)}function S(){return a.loop}function L(n){return(n%u+u)%u}function P(t){var i;i=t-T,w.push({distance:i,timestamp:e()}),w.length>6&&(w=w.slice(-6)),T=Math.round(1e6*t)/1e6;var r=_().abs;if(r!==M){var a=null!==M;M=r,a&&n.emit("slideChanged")}}function _(e){var c=e?null:function(){if(u){var n=S(),t=n?(T%i+i)%i:T,e=(n?T%i:T)-o[0][2],c=0-(e<0&&n?i-Math.abs(e):e),d=0,l=z(T),f=l.abs,p=l.rel,h=o[p][2],k=o.map((function(t,e){var r=c+d;(r<0-t[0]||r>1)&&(r+=(Math.abs(r)>i-1&&n?i:0)*s(-r));var o=e-p,l=s(o),v=o+f;n&&(-1===l&&r>h&&(v+=u),1===l&&r<h&&(v-=u),null!==g&&v<g&&(r+=i),null!==b&&v>b&&(r-=i));var m=r+t[0]+t[1],y=Math.max(r>=0&&m<=1?1:m<0||r>1?0:r<0?Math.min(1,(t[0]+r)/t[0]):(1-r)/t[0],0);return d+=t[0]+t[1],{abs:v,distance:a.rtl?-1*r+1-t[0]:r,portion:y,size:t[0]}}));return f=D(f),p=L(f),{abs:D(f),length:r,max:x,maxIdx:m,min:y,minIdx:v,position:T,progress:n?t/i:T/r,rel:p,slides:k}}}();return t.details=c,n.emit("detailsChanged"),c}return t={absToRel:L,add:C,details:null,distToIdx:E,idxToDist:I,init:function(t){if(function(){if(a=n.options,o=(a.trackConfig||[]).map((function(n){return[l(n,"size",1),l(n,"spacing",0),l(n,"origin",0)]})),u=o.length){i=f(o.reduce((function(n,t){return n+t[0]+t[1]}),0));var t,e=u-1;r=f(i+o[0][2]-o[e][0]-o[e][2]-o[e][1]),(d=o.reduce((function(n,e){if(!n)return[0];var i=o[n.length-1],r=n[n.length-1]+(i[0]+i[2])+i[1];return r-=e[2],n[n.length-1]>r&&(r=n[n.length-1]),r=f(r),n.push(r),(!t||t<r)&&(p=n.length-1),t=r,n}),null)).push(i)}}(),!u)return _(!0);var e;!function(){var t=n.options.range,e=n.options.loop;g=v=e?l(e,"min",-1/0):0,b=m=e?l(e,"max",k):p;var i=l(t,"min",null),r=l(t,"max",null);i&&(v=i),r&&(m=r),y=v===-1/0?v:n.track.idxToDist(v||0,!0,0),x=m===k?m:I(m,!0,0),null===r&&(b=m),l(t,"align",!1)&&m!==k&&0===o[L(m)][2]&&(x-=1-o[L(m)][0],m=E(x)),y=f(y),x=f(x)}(),e=t,Number(e)===e?C(A(D(t))):_()},to:P,velocity:function(){var n=e(),t=w.reduce((function(t,e){var i=e.distance,r=e.timestamp;return n-r>200||(s(i)!==s(t.distance)&&t.distance&&(t={distance:0,lastTimestamp:0,time:0}),t.time&&(t.distance+=i),t.lastTimestamp&&(t.time+=r-t.lastTimestamp),t.lastTimestamp=r),t}),{distance:0,lastTimestamp:0,time:0});return t.distance/t.time||0}}}function y(n){var t,e,i,r,a,o,u;function d(n){return 2*n}function l(n){return c(n,o,u)}function f(n){return 1-Math.pow(1-n,3)}function p(){h();var t="free-snap"===n.options.mode,e=n.track,o=e.velocity();i=s(o);var u=n.track.details,c=[];if(o||!t){var p=v(o),m=p.dist,g=p.dur;if(g=d(g),m*=i,t){var b=e.idxToDist(e.distToIdx(m),!0);b&&(m=b)}c.push({distance:m,duration:g,easing:f});var y=u.position,x=y+m;if(x<r||x>a){var k=x<r?r-y:a-y,w=0,M=o;if(s(k)===i){var T=Math.min(Math.abs(k)/Math.abs(m),1),C=function(n){return 1-Math.pow(1-n,1/3)}(T)*g;c[0].earlyExit=C,M=o*(1-T)}else c[0].earlyExit=0,w+=k;var E=v(M,100),z=E.dist*i;n.options.rubberband&&(c.push({distance:z,duration:d(E.dur),easing:f}),c.push({distance:-z+w,duration:500,easing:f}))}n.animator.start(c)}else n.moveToIdx(l(u.abs),!0,{duration:500,easing:function(n){return 1+--n*n*n*n*n}})}function v(n,t){void 0===t&&(t=1e3);var e=147e-9+(n=Math.abs(n))/t;return{dist:Math.pow(n,2)/e,dur:n/e}}function m(){var t=n.track.details;t&&(r=t.min,a=t.max,o=t.minIdx,u=t.maxIdx)}function h(){n.animator.stop()}n.on("updated",m),n.on("optionsChanged",m),n.on("created",m),n.on("dragStarted",(function(){h(),t=e=n.track.details.abs})),n.on("dragEnded",(function(){var i=n.options.mode;"snap"===i&&function(){var i=n.track,o=n.track.details,u=o.position,c=s(i.velocity());(u>a||u<r)&&(c=0);var d=t+c;0===o.slides[i.absToRel(d)].portion&&(d-=c),t!==e&&(d=e),s(i.idxToDist(d,!0))!==c&&(d+=c),d=l(d);var f=i.idxToDist(d,!0);n.animator.start([{distance:f,duration:500,easing:function(n){return 1+--n*n*n*n*n}}])}(),"free"!==i&&"free-snap"!==i||p()})),n.on("dragged",(function(){e=n.track.details.abs}))}function x(n){var t,e,d,l,f,p,v,m,h,g,b,y,x,k,w,M,T,C,E=u();function z(r){if(p&&m===r.id){var u=D(r);if(h){if(!O(r))return A(r);g=u,h=!1,n.emit("dragChecked")}if(M)return g=u;a(r);var x=function(t){if(T===-1/0&&C===1/0)return t;var i=n.track.details,r=i.length,a=i.position,o=c(t,T-a,C-a);if(0===r)return 0;if(!n.options.rubberband)return o;if(a<=C&&a>=T)return t;if(a<T&&e>0||a>C&&e<0)return t;var u=(a<T?a-T:a-C)/r,s=l*r,d=Math.abs(u*s),p=Math.max(0,1-d/f*2);return p*p*t}(v(g-u)/l*d);e=s(x);var k=n.track.details.position;(k>T&&k<C||k===T&&e>0||k===C&&e<0)&&o(r),b+=x,!y&&Math.abs(b*l)>5&&(y=!0,i(t,"moves","")),n.track.add(x),g=u,n.emit("dragged")}}function I(t){!p&&n.track.details&&n.track.details.length&&(y=!1,b=0,p=!0,h=!0,m=t.id,O(t),g=D(t),n.emit("dragStarted"))}function A(e){p&&m===e.idChanged&&(i(t,"moves",null),p=!1,n.emit("dragEnded"))}function O(n){var t=S(),e=t?n.y:n.x,i=t?n.x:n.y,r=void 0!==x&&void 0!==k&&Math.abs(k-i)<=Math.abs(x-e);return x=e,k=i,r}function D(n){return S()?n.y:n.x}function S(){return n.options.vertical}function L(){l=n.size,f=S()?window.innerHeight:window.innerWidth;var t=n.track.details;t&&(T=t.min,C=t.max)}function P(){if(E.purge(),n.options.drag&&!n.options.disabled){var e;e=n.options.dragSpeed||1,v="function"==typeof e?e:function(n){return n*e},d=n.options.rtl?-1:1,L(),t=n.container,function(){var n="data-keen-slider-clickable";r("[".concat(n,"]:not([").concat(n,"=false])"),t).map((function(n){E.add(n,"mousedown",o),E.add(n,"touchstart",o)}))}(),E.add(t,"dragstart",(function(n){a(n)})),E.input(t,"ksDragStart",I),E.input(t,"ksDrag",z),E.input(t,"ksDragEnd",A),E.input(t,"mousedown",I),E.input(t,"mousemove",z),E.input(t,"mouseleave",A),E.input(t,"mouseup",A),E.input(t,"touchstart",I,{passive:!0}),E.input(t,"touchmove",z,{passive:!1}),E.input(t,"touchend",A),E.input(t,"touchcancel",A),E.add(window,"wheel",(function(n){p&&a(n)}));var i="data-keen-slider-scrollable";r("[".concat(i,"]:not([").concat(i,"=false])"),n.container).map((function(n){return function(n){var t;E.input(n,"touchstart",(function(n){t=D(n),M=!0,w=!0}),{passive:!0}),E.input(n,"touchmove",(function(e){var i=S(),r=i?n.scrollHeight-n.clientHeight:n.scrollWidth-n.clientWidth,o=t-D(e),u=i?n.scrollTop:n.scrollLeft,c=i&&"scroll"===n.style.overflowY||!i&&"scroll"===n.style.overflowX;if(t=D(e),(o<0&&u>0||o>0&&u<r)&&w&&c)return M=!0;w=!1,a(e),M=!1})),E.input(n,"touchend",(function(){M=!1}))}(n)}))}}n.on("updated",L),n.on("optionsChanged",P),n.on("created",P),n.on("destroyed",E.purge)}function k(n){var t,e,i=null;function r(t,e,i){n.animator.active?o(t,e,i):requestAnimationFrame((function(){return o(t,e,i)}))}function a(){r(!1,!1,e)}function o(e,r,a){var o=0,u=n.size,d=n.track.details;if(d&&t){var l=d.slides;t.forEach((function(n,t){if(e)!i&&r&&c(n,null,a),s(n,null,a);else{if(!l[t])return;var d=l[t].size*u;!i&&r&&c(n,d,a),s(n,l[t].distance*u-o,a),o+=d}}))}}function u(t){return"performance"===n.options.renderMode?Math.round(t):t}function c(n,t,e){var i=e?"height":"width";null!==t&&(t=u(t)+"px"),n.style["min-"+i]=t,n.style["max-"+i]=t}function s(n,t,e){if(null!==t){t=u(t);var i=e?t:0;t="translate3d(".concat(e?0:t,"px, ").concat(i,"px, 0)")}n.style.transform=t,n.style["-webkit-transform"]=t}function d(){t&&(o(!0,!0,e),t=null),n.on("detailsChanged",a,!0)}function f(){r(!1,!0,e)}function p(){d(),e=n.options.vertical,n.options.disabled||"custom"===n.options.renderMode||(i="auto"===l(n.options.slides,"perView",null),n.on("detailsChanged",a),(t=n.slides).length&&f())}n.on("created",p),n.on("optionsChanged",p),n.on("beforeOptionsChanged",(function(){d()})),n.on("updated",f),n.on("destroyed",d)}function w(n,t){return function(e){var a,o,c,s,f,p,v=u();function h(n){var t;i(e.container,"reverse","rtl"!==(t=e.container,window.getComputedStyle(t,null).getPropertyValue("direction"))||n?null:""),i(e.container,"v",e.options.vertical&&!n?"":null),i(e.container,"disabled",e.options.disabled&&!n?"":null)}function g(){b()&&M()}function b(){var n=null;if(s.forEach((function(t){t.matches&&(n=t.__media)})),n===a)return!1;a||e.emit("beforeOptionsChanged"),a=n;var t=n?c.breakpoints[n]:c;return e.options=m(m({},c),t),h(),I(),A(),C(),!0}function y(n){var t=d(n);return(e.options.vertical?t.height:t.width)/e.size||1}function x(){return e.options.trackConfig.length}function k(n){for(var i in a=!1,c=m(m({},t),n),v.purge(),o=e.size,s=[],c.breakpoints||[]){var r=window.matchMedia(i);r.__media=i,s.push(r),v.add(r,"change",g)}v.add(window,"orientationchange",z),v.add(window,"resize",E),b()}function w(n){e.animator.stop();var t=e.track.details;e.track.init(null!=n?n:t?t.abs:0)}function M(n){w(n),e.emit("optionsChanged")}function T(n,t){if(n)return k(n),void M(t);I(),A();var i=x();C(),x()!==i?M(t):w(t),e.emit("updated")}function C(){var n=e.options.slides;if("function"==typeof n)return e.options.trackConfig=n(e.size,e.slides);for(var t=e.slides,i=t.length,r="number"==typeof n?n:l(n,"number",i,!0),a=[],o=l(n,"perView",1,!0),u=l(n,"spacing",0,!0)/e.size||0,c="auto"===o?u:u/o,s=l(n,"origin","auto"),d=0,f=0;f<r;f++){var p="auto"===o?y(t[f]):1/o-u+c,v="center"===s?.5-p/2:"auto"===s?0:s;a.push({origin:v,size:p,spacing:u}),d+=p}if(d+=u*(r-1),"auto"===s&&!e.options.loop&&1!==o){var m=0;a.map((function(n){var t=d-m;return m+=n.size+u,t>=1||(n.origin=1-t-(d>1?0:1-d)),n}))}e.options.trackConfig=a}function E(){I();var n=e.size;e.options.disabled||n===o||(o=n,T())}function z(){E(),setTimeout(E,500),setTimeout(E,2e3)}function I(){var n=d(e.container);e.size=(e.options.vertical?n.height:n.width)||1}function A(){e.slides=r(e.options.selector,e.container)}e.container=(p=r(n,f||document)).length?p[0]:null,e.destroy=function(){v.purge(),e.emit("destroyed"),h(!0)},e.prev=function(){e.moveToIdx(e.track.details.abs-1,!0)},e.next=function(){e.moveToIdx(e.track.details.abs+1,!0)},e.update=T,k(e.options)}}var M=function(n,t,e){try{return function(n,t){var e,i={};return e={emit:function(n){i[n]&&i[n].forEach((function(n){n(e)}));var t=e.options&&e.options[n];t&&t(e)},moveToIdx:function(n,t,i){var r=e.track.idxToDist(n,t);if(r){var a=e.options.defaultAnimation;e.animator.start([{distance:r,duration:l(i||a,"duration",500),easing:l(i||a,"easing",(function(n){return 1+--n*n*n*n*n}))}])}},on:function(n,t,e){void 0===e&&(e=!1),i[n]||(i[n]=[]);var r=i[n].indexOf(t);r>-1?e&&delete i[n][r]:e||i[n].push(t)},options:n},function(){if(e.track=b(e),e.animator=g(e),t)for(var n in t){var i=t[n];i&&i(e)}e.track.init(e.options.initial||0),e.emit("created")}(),e}(t,h([w(n,{drag:!0,mode:"snap",renderMode:"precision",rubberband:!0,selector:".keen-slider__slide"}),k,x,y],e||[],!0))}catch(n){console.error(n)}};exports.useKeenSlider=function(t,e){var i=n.useRef(null),r=n.useRef(!1),a=n.useRef(t),o=n.useCallback((function(n){n?(a.current=t,i.current=new M(n,t,e),r.current=!1):(i.current&&i.current.destroy&&i.current.destroy(),i.current=null)}),[]);return n.useEffect((function(){r.current?i.current&&i.current.update(a.current):r.current=!0}),[v(a,t)]),[o,i]};
